<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.15.2 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="ko" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Simple IoT accelerometer game Tutorial - 호롤리한 하루</title>
<meta name="description" content="Learn how to capture and send sensor data to the cloud using Watson IoT Platform and then analyze that data using Watson Studio1. Overview디바이스의 센서데이터를 cloud상에 저장시키고, 저장된 데이터를 왓슨스튜디오로 분석하여 센싱데이터의 에너지 총량을 도출할 수 있는 application입니다.">



<meta property="og:type" content="article">
<meta property="og:locale" content="ko">
<meta property="og:site_name" content="호롤리한 하루">
<meta property="og:title" content="Simple IoT accelerometer game Tutorial">
<meta property="og:url" content="http://localhost:4000/simple-tutorial/iot-tutorial/">


  <meta property="og:description" content="Learn how to capture and send sensor data to the cloud using Watson IoT Platform and then analyze that data using Watson Studio1. Overview디바이스의 센서데이터를 cloud상에 저장시키고, 저장된 데이터를 왓슨스튜디오로 분석하여 센싱데이터의 에너지 총량을 도출할 수 있는 application입니다.">







  <meta property="article:published_time" content="2019-03-19T00:00:00+09:00">



  <meta property="article:modified_time" content="2019-03-22T13:00:00+09:00">



  

  


<link rel="canonical" href="http://localhost:4000/simple-tutorial/iot-tutorial/">







  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Person",
      "name": "GRU",
      "url": "http://localhost:4000",
      "sameAs": null
    }
  </script>







<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="호롤리한 하루 Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if IE ]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">호롤리한 하루</a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/about/" >About</a>
            </li><li class="masthead__menu-item">
              <a href="/categories/" >Tech-Posts</a>
            </li><li class="masthead__menu-item">
              <a href="/Something/" >Something</a>
            </li><li class="masthead__menu-item">
              <a href="/sitemap/" >Sitemap</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">토글 메뉴</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      

      
        <img src="/assets/images/p.png" alt="GRU" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">GRU</h3>
    
    
      <p class="author__bio" itemprop="description">
        호롤리
      </p>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">팔로우</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Somewhere</span>
        </li>
      

      
        
          
        
          
        
          
        
          
        
          
        
          
        
      

      

      
        <li>
          <a href="mailto:sygy0509@naver.com">
            <meta itemprop="email" content="sygy0509@naver.com" />
            <i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i> 이메일
          </a>
        </li>
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>


  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Simple IoT accelerometer game Tutorial">
    <meta itemprop="description" content="Learn how to capture and send sensor data to the cloud using Watson IoT Platform and then analyze that data using Watson Studio1. Overview디바이스의 센서데이터를 cloud상에 저장시키고, 저장된 데이터를 왓슨스튜디오로 분석하여 센싱데이터의 에너지 총량을 도출할 수 있는 application입니다.">
    <meta itemprop="datePublished" content="March 19, 2019">
    <meta itemprop="dateModified" content="March 22, 2019">

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Simple IoT accelerometer game Tutorial
</h1>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
        <p>Learn how to capture and send sensor data to the cloud using Watson IoT Platform and then analyze that data using Watson Studio</p>
<h2 id="1-overview">1. Overview</h2>
<p>디바이스의 센서데이터를 cloud상에 저장시키고, 저장된 데이터를 왓슨스튜디오로 분석하여 센싱데이터의 에너지 총량을 도출할 수 있는 application입니다.</p>

<p>IBM Developer blog에 게재된 “<a href="https://developer.ibm.com/tutorials/iot-simple-iot-accelerometer-game/">Create a fun, simple IoT accelerometer game</a>“를 따라 진행해보도록 하겠습니다.</p>

<blockquote>
  <p>기대효과</p>
  <ul>
    <li>IoT에 대한 흥미유발</li>
    <li>IBM Cloud 사용법과, Watson Studio의 사용법 숙지</li>
    <li>다수가 모인 자리에서 킬링타임용 게임진행</li>
  </ul>
</blockquote>

<h2 id="2-prerequisites">2. Prerequisites</h2>
<p><code class="highlighter-rouge">IBM Cloud</code>와 <code class="highlighter-rouge">IBM Watson</code>계정을 만들어주세요.<br />
<code class="highlighter-rouge">IBM Cloud</code> : <a href="https://console.bluemix.net">link</a><br />
<code class="highlighter-rouge">IBM Watson</code> : <a href="https://dataplatform.cloud.ibm.com/">link</a><br />
+) 센서 데이터를 수집해야 하므로, 테스트할 기기로 스마트폰 또는 노트북을 지참해주세요.</p>

<h2 id="3-deploy-application">3. Deploy Application</h2>
<p>센서데이터를 수집할 수 있는 웹 애플리케이션을 클라우드상에 배포해보는 과정입니다.</p>

<p>다음 버튼을 클릭해서 IBM cloud상에 배포해봅시다.<br />
<a href="https://bluemix.net/deploy?repository=https://github.com/romeokienzler/discover-iot-sample"><img src="https://bluemix.net/deploy/button.png" alt="Deploy to Bluemix" /></a></p>
<blockquote>
  <p>출처: <a href="https://github.com/romeokienzler/discover-iot-sample">romeokienzler/discover-iot-sample</a></p>
</blockquote>

<p>cloud에 배포하기전 설정 화면이 나타납니다.<br />
<img width="666" alt="1" src="https://user-images.githubusercontent.com/15958325/54485909-2ac73900-48c4-11e9-93cb-0638822ce06d.PNG" /></p>
<blockquote>
  <p><b>주의</b> : 주의해야할 점은 지역을 댈러스로 선택해야 한다는 것입니다. <b>댈러스</b> 외의 다른 지역을 선택하면 앱을 실행하기 위한 몇가지 플러그인이 존재하지 않는 것 같습니다.</p>
</blockquote>

<p>지역을 선택한 뒤, API키 작성을 눌러 API키를 생성하고 Deploy버튼을 눌러 앱을 클라우드상에 배포합니다.<br />
<img width="370" alt="2" src="https://user-images.githubusercontent.com/15958325/54485946-cce72100-48c4-11e9-836a-7193d8d20884.PNG" /><br />
<img width="477" alt="3" src="https://user-images.githubusercontent.com/15958325/54485993-61ea1a00-48c5-11e9-84d3-c42618d1bab8.PNG" /></p>

<p>Deliver Pipeline을 클릭해보면 github에서 가져온 코드가 클라우드상에 배포되고 있는 모습을 확인할 수 있습니다. <br />
<img width="445" alt="4" src="https://user-images.githubusercontent.com/15958325/54485995-63b3dd80-48c5-11e9-80da-6fe0a7b02c48.PNG" /></p>

<p>몇가지 설정을 바꾸기 위해 Deploy Stage의 단계구성을 클릭해줍니다.<br />
<img width="223" alt="5" src="https://user-images.githubusercontent.com/15958325/54485996-66163780-48c5-11e9-851e-0d000451eef5.PNG" /></p>

<p>아래 사진과 같이 입력유형을 Git 저장소, 분기를 master로 바꿔준 뒤 저장해 줍니다.<br />
<img width="419" alt="6" src="https://user-images.githubusercontent.com/15958325/54486041-e8066080-48c5-11e9-8da9-84cdd95db382.PNG" /><br />
저장하고 난 뒤, 빌드부터 새로 재시작해줍니다.</p>

<p>앱이 정상적으로 가동된다면 앱URL방문을 클릭합니다.<br />
<img width="565" alt="7" src="https://user-images.githubusercontent.com/15958325/54486042-e89ef700-48c5-11e9-8c4c-71fc1159c2d7.PNG" /></p>

<p>방문하게 되면, Step1에 하나의 링크가 보이게 됩니다. 이 링크는 디바이스에서 센서데이터를 측정해서 화면에 띄워주는 웹기반 application입니다.<br />
<img width="575" alt="8" src="https://user-images.githubusercontent.com/15958325/54486043-e9378d80-48c5-11e9-9dbd-2ff30d271358.PNG" /><br />
이 링크를 따라 접속해봅시다.</p>

<p>User의 Id와 Pw를 입력하고나면 연결되었다는 표시와 함께 Movement, Acceleration에 관한 센서값들을 확인할 수 있습니다.<br />
<img width="606" alt="9" src="https://user-images.githubusercontent.com/15958325/54486044-ea68ba80-48c5-11e9-9210-74a69866780a.PNG" /></p>

<p>지금까지 과정은 단순히 클라우드에 앱을 배포하는 것입니다. 의미있는 데이터를 뽑아내기위해, 센서데이터들을 저장할 수 있는 DB가 필요합니다. 다음 챕터에서는 데이터들을 저장시킬 수 있는 DB설정에 대해 다뤄보겠습니다.</p>

<h2 id="4-replace-iot-service--set-nosqldb">4. Replace IoT Service &amp; Set NoSQLDB</h2>
<p>센서데이터를 클라우드로 가져오기 위해서, <code class="highlighter-rouge">Node-Red</code>라는 오픈소스 GUI flow 에디터를 사용하겠습니다. <code class="highlighter-rouge">Node-Red</code>를 통해 디바이스에서 송신되는 <code class="highlighter-rouge">MQTT</code>기반 데이터들을 DB에 저장할 것입니다.</p>

<p>첫번째로, <a href="https://console.bluemix.net/catalog/starters/internet-of-things-platform-starter">Internet of Things Platform Starter</a>로 들어가서 앱을 작성해 줍니다.</p>
<blockquote>
  <p>경로 : 카탈로그&gt;스타터 킷&gt;Internet of Things Platform 스타터</p>
</blockquote>

<p><img width="712" alt="10" src="https://user-images.githubusercontent.com/15958325/54486139-23edf580-48c7-11e9-8521-419c5f4dc60b.PNG" /><br />
생성하기를 누른 뒤, Running상태가 되면 왼쪽 메뉴에서 <code class="highlighter-rouge">연결</code> 항목으로 들어갑니다.</p>

<p>기본적으로 생성된 IoT Platform서비스를 해제 시킵니다. 그 뒤, 서비스 인스턴트도 삭제시켜줍니다.<br />
<img width="748" alt="11" src="https://user-images.githubusercontent.com/15958325/54486140-26504f80-48c7-11e9-8d66-c622b8b98c8c.PNG" /><br />
re-stage할것이냐는 메세지가 뜰텐데 cancel을 누르고 다음 단계로 진행합니다.</p>

<p>연결작성(Connect existing)버튼을 누르고 <code class="highlighter-rouge">discover-iot-try-service</code>를 연결시킵니다. 그 뒤 리스테이징을 눌러 앱을 재시작시킵니다.<br />
<img width="729" alt="12" src="https://user-images.githubusercontent.com/15958325/54486141-26504f80-48c7-11e9-8e2a-ffee1b0a9791.PNG" /></p>

<p>앱이 Running 상태가 되면, <code class="highlighter-rouge">discover-iot-try-service</code>를 클릭해 Watson IoT Platform을 시작시킵니다.<br />
<img width="592" alt="13" src="https://user-images.githubusercontent.com/15958325/54486142-26e8e600-48c7-11e9-9783-ae2093863ebb.PNG" /></p>

<p>실행시키면 왼쪽 메뉴가 가려져서 잘 안보이는데 마우스를 올리면 잘 보이게 됩니다. 자물쇠처럼 생긴 Security메뉴를 클릭합니다. 뜨는 리스트 중, 연결보안(Connection Security) 수정버튼을 클릭합니다.<br />
<img width="758" alt="14" src="https://user-images.githubusercontent.com/15958325/54486143-26e8e600-48c7-11e9-9b10-cc96edcc9482.PNG" /><br />
Security Level을 TLS Optional(TLS 선택적)으로 변경시켜준 뒤, Refresh 시켜줍니다.</p>
<blockquote>
  <p><b>TLS Optional</b><br />
TLS Optional에서는 장치가 TLS 1.1 이상과 연결하지 않을 때 네트워크 통신의 암호화를 강제 실행하지 않습니다. 비TLS 연결을 사용하면 네트워크에 있는 다른 사용자가 디바이스 신임 정보와 민감한 데이터를 볼 수 있습니다. TLS Optional을 통해 전송되는 데이터를 보호할 책임은 전적으로 사용자에게 있습니다.</p>
</blockquote>

<p>저장하고 다시 IBM Cloud Foundry Apps로 돌아옵니다.<br />
App URL방문을 통해 <code class="highlighter-rouge">Node-Red</code>를 실행시킵시다.
<img width="636" alt="15" src="https://user-images.githubusercontent.com/15958325/54487078-a4ffb980-48d4-11e9-9125-a4075002f246.PNG" /></p>

<p>가이드에 따라 쭉쭉 진행한 뒤, 에디터 화면을 살펴보면 요상한 그래프들이 많이 보일겁니다. 다 지우고 아래 사진과 같이 세팅해 주세요.<br />
<img width="467" alt="16" src="https://user-images.githubusercontent.com/15958325/54487079-a4ffb980-48d4-11e9-83f5-2a7c1753c918.PNG" /></p>

<p>IBM IoT노드의 Authentication을 Bluemix Service로 바꿔줍니다. 이는 IBM IoT node가 MQTT브로커와 연결하기위한 credential를 Cloud Foundry credentials injection을 통해 가져오겠다는 뜻입니다. <br />
<img width="391" alt="17" src="https://user-images.githubusercontent.com/15958325/54487080-a4ffb980-48d4-11e9-8f7c-9f81da08324b.PNG" /><br />
설정이 끝났다면 오른쪽상단의 Deploy버튼을 눌러줍니다.<br />
이전에 배포했던 IoT app을 디바이스에서 실행시킨 뒤, Debug탭을 눌러 날아오는 msg들을 확인할 수 있습니다.<br />
<img width="509" alt="18" src="https://user-images.githubusercontent.com/15958325/54487082-a5985000-48d4-11e9-9204-abd787b7c3d1.PNG" /><br />
날아가는 데이터들은 <code class="highlighter-rouge">discover-iot-try-service</code>의 <code class="highlighter-rouge">Watson IoT Platform</code>&gt;<code class="highlighter-rouge">Divices</code>탭에서 확인할 수 있습니다.<br />
<img width="581" alt="19" src="https://user-images.githubusercontent.com/15958325/54487313-3a507d00-48d8-11e9-923f-69ad118cd00a.PNG" /></p>

<p>근데 msg가 object타입으로 날아와서 한눈에 알아보기가 힘드네요. function노드를 통해 msg를 꾸며봅시다.<br />
<img width="471" alt="18 5" src="https://user-images.githubusercontent.com/15958325/54487081-a5985000-48d4-11e9-8667-ea041f2837b0.PNG" /></p>
<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//function에 들어가야 할 부분</span>
<span class="nx">msg</span><span class="p">.</span><span class="nx">payload</span> <span class="o">=</span>
<span class="p">{</span>
<span class="na">X</span> <span class="p">:</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">payload</span><span class="p">.</span><span class="nx">d</span><span class="p">.</span><span class="nx">ax</span><span class="p">,</span>
<span class="na">Y</span> <span class="p">:</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">payload</span><span class="p">.</span><span class="nx">d</span><span class="p">.</span><span class="nx">ay</span><span class="p">,</span>
<span class="na">Z</span> <span class="p">:</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">payload</span><span class="p">.</span><span class="nx">d</span><span class="p">.</span><span class="nx">az</span><span class="p">,</span>
<span class="na">SENSORID</span> <span class="p">:</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">payload</span><span class="p">.</span><span class="nx">d</span><span class="p">.</span><span class="nx">id</span>
<span class="p">}</span>
<span class="k">return</span> <span class="nx">msg</span><span class="p">;</span>
</code></pre></div></div>

<p>날아오는 데이터를 Debug탭에서 확인해보면 바뀐것을 확인할 수 있습니다.<br />
<img width="189" alt="20" src="https://user-images.githubusercontent.com/15958325/54487314-3a507d00-48d8-11e9-9825-f9dce28eb7a5.PNG" /></p>

<p>이제 클라우드상에 데이터를 저장할 NoSQL DB로서 <code class="highlighter-rouge">Cloudant</code>를 추가시킵니다.</p>
<blockquote>
  <p><code class="highlighter-rouge">IBM Cloudant</code>는 <code class="highlighter-rouge">ApacheCouchDB</code>에 기반하고 있습니다.</p>
</blockquote>

<p><img width="592" alt="cloudant" src="https://user-images.githubusercontent.com/15958325/54487484-d8911280-48d9-11e9-836a-886bf56c73ef.PNG" />  <br />
<img width="308" alt="21" src="https://user-images.githubusercontent.com/15958325/54487316-3a507d00-48d8-11e9-9785-e92b9e7560da.PNG" /></p>

<p>추가적으로 데이터가 너무 빨리 송신되는 것을 막기 위해, delay node를 추가적으로 생성해 줍시다.<br />
<img width="615" alt="delay" src="https://user-images.githubusercontent.com/15958325/54487483-d7f87c00-48d9-11e9-8de7-84ca7cebf47d.PNG" /></p>

<p>노드의 전체 도식도는 다음과 같습니다.<br />
<img src="https://user-images.githubusercontent.com/15958325/54487528-6d940b80-48da-11e9-8810-6a5ddf478869.png" alt="image" /></p>

<p>이제 센서데이터를 송신받아 <code class="highlighter-rouge">Cloudant</code>에 저장하는 것까지 완성되었습니다!<br />
하지만 단순히 데이터를 저장만 하는 것은 아무런 의미를 갖지 못합니다. 때문에 데이터를 분석하여 의미있는 값을 도출해 내는 것이 중요합니다.</p>

<h2 id="5-analyze-data-with-watson-studio">5. Analyze Data with Watson Studio</h2>
<blockquote>
  <p>왓슨스튜디오를 처음 사용하는 유저는 먼저 상단의 Upgrade 버튼을 누른 뒤, Watson Studio와 Knowledge Catalog Bundle들을 설치해주세요.<br />
<img src="https://user-images.githubusercontent.com/15958325/54487624-7a652f00-48db-11e9-8c13-58ef8649aa53.png" alt="image" /></p>
</blockquote>

<p>새로운 프로젝트를 생성해 주세요.<br />
<img width="624" alt="22" src="https://user-images.githubusercontent.com/15958325/54487317-3ae91380-48d8-11e9-8e75-399805a199d3.PNG" /><br />
<img width="625" alt="23" src="https://user-images.githubusercontent.com/15958325/54487318-3ae91380-48d8-11e9-8725-b6781a178de3.PNG" /></p>

<p>프로젝트에 Object Storage를 추가해 줍니다.<br />
<img width="729" alt="24" src="https://user-images.githubusercontent.com/15958325/54487664-1b53ea00-48dc-11e9-8524-f86a2b2e6e61.PNG" /><br />
<img width="763" alt="25" src="https://user-images.githubusercontent.com/15958325/54487665-1b53ea00-48dc-11e9-8f2c-c48e40c98bd7.PNG" /></p>

<p>추가하고나서 Refresh버튼을 눌러줍니다.<br />
<img width="731" alt="26" src="https://user-images.githubusercontent.com/15958325/54487666-1b53ea00-48dc-11e9-96d4-9131a84824bb.PNG" /></p>

<p>프로젝트를 생성하고 나서, Spark 서비스를 추가시킵니다.<br />
<img width="779" alt="27" src="https://user-images.githubusercontent.com/15958325/54487668-1b53ea00-48dc-11e9-94f3-285e1beebb9f.PNG" /><br />
<img width="741" alt="28" src="https://user-images.githubusercontent.com/15958325/54487669-1bec8080-48dc-11e9-8a1e-e7b6741e0e4f.PNG" /><br />
프로젝트의 초기 설정은 끝!</p>

<p>다음은 실제로 어떻게 데이터를 분석할 것인지 정하는 <code class="highlighter-rouge">Notebook</code>을 구성해봅시다.<br />
프로젝트 상단에 Add to project버튼을 눌러보면 <code class="highlighter-rouge">Notebook</code>을 생성하는 버튼이 있습니다.</p>

<p>이 튜토리얼은 하단의 github링크로부터 <code class="highlighter-rouge">Notebook</code>을 가져올 것입니다.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://raw.githubusercontent.com/romeokienzler/developerWorks/master/boomboomshakeshakesparkv2.ipynb
</code></pre></div></div>
<p><img src="https://user-images.githubusercontent.com/15958325/54489749-df784f00-48f2-11e9-8dd8-9f5b6ed9a99a.png" alt="image" />  <br />
runtime은 방금전에 만들었던 spark서비스를 가져옵니다.</p>

<p><code class="highlighter-rouge">Notebook</code>에서 분석용으로 사용할 DB Connection을 만들어줘야 합니다. 다음 사진을 보고 project page로 돌아가줍니다.<br />
<img width="597" alt="30" src="https://user-images.githubusercontent.com/15958325/54487671-1bec8080-48dc-11e9-8654-39e2dad9fbca.PNG" /><br />
Connection을 클릭하고, 만들었던 Cloudant를 클릭한 뒤, Create버튼을 클릭해줍니다.<br />
<img src="https://user-images.githubusercontent.com/15958325/54487808-8fdb5880-48dd-11e9-9724-44ab6ba7a980.png" alt="image" /></p>

<p>다시 <code class="highlighter-rouge">Notebook</code>페이지로 돌아가서 하단의 코드블럭안에 Connection을 Insert합니다.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#PLEASE INSERT TO CREDENTIALS TO CLOUDANT HERE USING THE IBM WATSON STUDIO CONNECTIONS TAB RIGHT TO THIS NOTEBOOK
#이곳에 Insert
</span></code></pre></div></div>
<p><img width="783" alt="34" src="https://user-images.githubusercontent.com/15958325/54487794-6cb0a900-48dd-11e9-99d5-0a1677fb56e9.PNG" /></p>

<blockquote>
  <p><b>주의</b> : DB를 넣는 코드블럭 밑에 credentials을 참조하는 변수가 있습니다. credentials_1을 변수네임으로써 사용하고 있으므로 Connection을 Insert한 뒤, 이름을 credentials_1로 바꿔주어야 합니다.</p>
</blockquote>

<p>코드를 RUN하기 전에 고쳐야할 부분이 몇가지 있습니다. 패키지를 다운로드 받는 부분인 첫번째 코드블럭을 봐주세요.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">pixiedust</span>
<span class="n">pixiedust</span><span class="o">.</span><span class="n">installPackage</span><span class="p">(</span><span class="s">"https://github.com/romeokienzler/developerWorks/raw/master/coursera/spark-sql-cloudant_2.11-2.3.0-SNAPSHOT.jar"</span><span class="p">)</span>
<span class="n">pixiedust</span><span class="o">.</span><span class="n">installPackage</span><span class="p">(</span><span class="s">"com.typesafe:config:1.3.1"</span><span class="p">)</span>
<span class="n">pixiedust</span><span class="o">.</span><span class="n">installPackage</span><span class="p">(</span><span class="s">"com.typesafe.play:play-json_2.11:jar:2.5.9"</span><span class="p">)</span>
<span class="n">pixiedust</span><span class="o">.</span><span class="n">installPackage</span><span class="p">(</span><span class="s">"org.scalaj:scalaj-http_2.11:jar:2.3.0"</span><span class="p">)</span>
<span class="n">pixiedust</span><span class="o">.</span><span class="n">installPackage</span><span class="p">(</span><span class="s">"com.typesafe.play:play-functional_2.11:jar:2.5.9"</span><span class="p">)</span>
</code></pre></div></div>

<p>위 코드의 첫줄인 github에서 패키지를 다운로드 받는 부분은 주석처리를 해야합니다.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#pixiedust.installPackage("https://github.com/romeokienzler/developerWorks/raw/master/coursera/spark-sql-cloudant_2.11-2.3.0-SNAPSHOT.jar")
</span></code></pre></div></div>
<p>첫번째로 예제로 올라온 링크가 유효하지 않다는 점.<br />
두번째로 유효한 링크를 넣어도 ‘NoneType’ object has no attribute ‘strip’ 에러가 발생합니다.<br />
없애도 정상적으로 돌아갑니다…</p>
<blockquote>
  <p>spark-sql-cloudant_2.11-2.3.0-SNAPSHOT.jar파일이 정확히 어떤 역할을 하고, 없어도 제대로 돌아가는 이유에 대해서는 파악하지 못했습니다.</p>
</blockquote>

<p>다음으로 바꿔야 할 부분은 DB의 네임입니다.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="o">=</span><span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">load</span><span class="p">({</span><span class="s">'cloudant의 이름'</span><span class="p">},</span> <span class="s">'org.apache.bahir.cloudant'</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">createOrReplaceTempView</span><span class="p">(</span><span class="s">'data'</span><span class="p">)</span>
</code></pre></div></div>

<p>이 튜토리얼에서 제가 썻던 이름은 harlemshake였으니 다음과 같이 구성될 것입니다.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span><span class="o">=</span><span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s">'harlemshake'</span><span class="p">,</span> <span class="s">'org.apache.bahir.cloudant'</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">createOrReplaceTempView</span><span class="p">(</span><span class="s">'data'</span><span class="p">)</span>
</code></pre></div></div>

<p>수정해야할 부분을 수정했다면 Cell&gt;Run All 버튼을 클릭합시다. 
<img src="https://user-images.githubusercontent.com/15958325/54489692-46493880-48f2-11e9-8898-573145d558dd.png" alt="image" /><br />
<code class="highlighter-rouge">Cloudant</code>에 접속하여 데이터를 전송했던 id들의 리스트가 <code class="highlighter-rouge">Notebook</code>에서 정의했던 규칙대로 정렬된 모습을 확인할 수 있습니다.</p>

<blockquote>
  <p>에너지 총량 계산 방법 :</p>
  <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">select</span> <span class="n">sqrt</span><span class="p">(</span><span class="k">sum</span><span class="p">(</span><span class="n">X</span><span class="o">*</span><span class="n">X</span><span class="p">)</span><span class="o">+</span><span class="k">sum</span><span class="p">(</span><span class="n">Y</span><span class="o">*</span><span class="n">Y</span><span class="p">)</span><span class="o">+</span><span class="k">sum</span><span class="p">(</span><span class="n">Z</span><span class="o">*</span><span class="n">Z</span><span class="p">))</span> <span class="k">as</span> <span class="n">energy</span><span class="p">,</span> <span class="n">SENSORID</span> <span class="k">from</span> <span class="k">data</span> <span class="k">group</span> <span class="k">by</span> <span class="n">SENSORID</span> <span class="k">order</span> <span class="k">by</span> <span class="n">energy</span> <span class="k">desc</span>
</code></pre></div>  </div>
  <p><img src="https://user-images.githubusercontent.com/15958325/54489777-38e07e00-48f3-11e9-93b1-ee0501562af1.png" alt="image" /><br />
energy값으로 내림차순</p>

</blockquote>

<p>-튜토리얼 끗-</p>

<hr />
<p><img width="100" height="100" src="https://user-images.githubusercontent.com/15958325/54489815-c58b3c00-48f3-11e9-81a1-b2e2afcd0ae7.png" /></p>

        
      </section>

      <footer class="page__meta">
        
        


  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> 카테고리: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/categories/#simple-tutorial" class="page__taxonomy-item" rel="tag">Simple-Tutorial</a>
    
    </span>
  </p>


        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> 업데이트:</strong> <time datetime="2019-03-22">March 22, 2019</time></p>
        
      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">공유하기</h4>
  

  <a href="https://twitter.com/intent/tweet?text=Simple+IoT+accelerometer+game+Tutorial%20http%3A%2F%2Flocalhost%3A4000%2Fsimple-tutorial%2Fiot-tutorial%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="공유하기 Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Flocalhost%3A4000%2Fsimple-tutorial%2Fiot-tutorial%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="공유하기 Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Flocalhost%3A4000%2Fsimple-tutorial%2Fiot-tutorial%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="공유하기 LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/sawtooth-starter/sawtooth-starter10/" class="pagination--pager" title="10.Using Grafana &amp; InfluxDB in Sawtooth
">이전</a>
    
    
      <a href="#" class="pagination--pager disabled">다음</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">참고</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/sawtooth-starter/sawtooth-starter10/" rel="permalink">10.Using Grafana &amp; InfluxDB in Sawtooth
</a>
      
    </h2>
    
    <p class="archive__item-excerpt" itemprop="description">이 문서는 hyperledger sawtooth 1.0.4을 docker for ubuntu(18.03.01-ce)에서 다루며 os는 ubuntu-18.04 LTS임

</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/sawtooth-starter/sawtooth-starter09/" rel="permalink">09.Building and Submitting Transactions with js
</a>
      
    </h2>
    
    <p class="archive__item-excerpt" itemprop="description">이 문서는 hyperledger sawtooth 1.0.4을 docker for ubuntu(18.03.01-ce)에서 다루며 os는 ubuntu-18.04 LTS임

</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/sawtooth-starter/sawtooth-starter08/" rel="permalink">08.Configuring Permission
</a>
      
    </h2>
    
    <p class="archive__item-excerpt" itemprop="description">이 문서는 hyperledger sawtooth 1.0.4을 docker for ubuntu(18.03.01-ce)에서 다루며 os는 ubuntu-18.04 LTS임

</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/sawtooth-starter/sawtooth-starter07/" rel="permalink">07.Make Custom Processor and Connect to Validator
</a>
      
    </h2>
    
    <p class="archive__item-excerpt" itemprop="description">이 문서는 hyperledger sawtooth 1.0.4을 docker for windows(18.03.01-ce-win65)에서 다루며 os는 window 10 pro임

</p>
  </article>
</div>

        
      </div>
    </div>
  
  
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><input type="text" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
    <div id="results" class="results"></div></div>

      </div>
    

    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>팔로우:</strong></li>
    

    
      
        
      
        
      
        
      
        
      
        
      
        
      
    

    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> 피드</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2019 GRU. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>
  <script data-search-pseudo-elements defer src="https://use.fontawesome.com/releases/v5.7.1/js/all.js" integrity="sha384-eVEQC9zshBn0rFj4+TU78eNA19HMNigMviK/PU/FFjLXqa/GKPgX58rvt5Z8PLs7" crossorigin="anonymous"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>




    <div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.5";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>
  



  </body>
</html>
